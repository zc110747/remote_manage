# **1.U-Boot开发技术**

## **1.1 U-Boot综述**
U-Boot，又称Universal Boot Loader, 是遵循GPL条款的开放源代码项目，在嵌入式Linux系统中负责对于系统的引导，其功能有点类似与windows系统中的BIOS，Uboot目录的结构如下所示。<br />

| name     | function     |
| -------   | -------- | 
| api | 与硬件无关的接口函数 | 
| **arch** | **与芯片架构体系有关的代码** |
| **board** | **板级的定制代码** |
| cmd | 支持命令的代码 |
| common | 通用代码 |
| configs | 配置文件 |
| **disk** | **磁盘分区的代码** |
| doc | 文档 |
| **dirvers** | **驱动** |
| **dts** | **设备树** |
| examples | 例程代码 |
| **fs** | **文件系统** |
| include | 头文件 |
| lib | 库文件 |
| Licenses | 许可证文件 |
| net | 网络相关文件 | 
| post | 上电自检程序 | 
| **scripts** | **脚本文件** |
| test | 测试文件 |
| tools | 工具文件 |


# **2.常见知识总结**

## **2.1 进程，线程和协程区别和联系**
1.进程是资源调度的基本单位，一个进程可以有多个线程，但至少有一个线程.<br/>
2.线程是程序执行的基本单位，是轻量级的进程，协程是用户态轻量级的线程，线程内部调度的基本单位.<br/>
3.线程启动速度快，轻量级，系统开销小.<br/>

## **2.2 串行，并行和并发**
串行: 一次只能取得一个任务并执行这个任务，这个任务执行完后面才能继续.<br/>
并发:指在同一时间段内，多条指令在CPU上同时执行.<br/>
并行:指在同一时刻时，多条指令在CPU上同时执行.<br/>
串行通讯: 数据按位顺序进行传输, 最少采用单线即可传输，包含USART，SPI， I2C或单线通讯等.<br/>
并行通讯:多个bit数据通过并行线进行传输.<br/>

## **2.3 进程调度算法**
1.先来先服务(first come, first serverd- fcfs)<br/>
&emsp;&emsp;非抢占式的调度算法，按照请求的顺序进行调度，有利于长作业，不利于短作业，会造成短作业等待时间过长.<br/>
2.短作业优先(shortest job first – sjf)<br/>
&emsp;&emsp;非抢占式的调度算法，按估计运行时间最短的顺序进行调度。长作业可能永远无法执行.<br/>
3.最短剩余时间优先(shortest remaining time next – srtn)<br/>
&emsp;&emsp;最短作业优先的抢占式版本，按剩余运行时间的顺序进行调度。当一个新的作业到达时，整个运行时间与当前进程的剩余时间作比较。执行剩余运行时间最短的顺序进行调度.<br/>
4.时间片轮转<br/>
&emsp;&emsp;将所有就绪进程按FCFS的原则排成一个队列，每次调度时，将CPU时间分配给首进程，该进程可以执行一个时间片，当时间片用完后，由定时器发出时钟中断，调度程序便停止该进程的执行，并将它送往就绪队列的末尾，同时继续将CPU时间分配给队首的进程.<br/>
5.优先级调度<br/>
&emsp;&emsp;为每个进程分配优先级，按优先级进行调度.<br/>
6.多级反馈队列<br/>
&emsp;&emsp;时间片轮转调度算法和优先级调度算法的结合.<br/>

## **2.4 进程间通信方式**
1.管道<br/>
&emsp;&emsp;无名管道(内存文件):管道是一种半双工的通信方式，数据只能单向流动，而且只能在具有亲缘关系的进程之间使用.<br/>
&emsp;&emsp;有名管道(FIFO文件):有名管道也是半双工的通信方式，允许在没有亲缘关系的进程之间使用，管道是先进先出的通讯方式.<br/>
2.共享内存<br/>
&emsp;&emsp;共享内存就是映射一段被其它进程所访问的内存，这段内存由一个进程创建，但多个进程都可以访问，共享内存和最快的IPC方式，和信号量配合使用，实现进程间的同步通信.<br/>
3.消息队列<br/>
&emsp;&emsp;消息队列是有消息的链表，存放在内核中并由消息队列标识符标识.<br/>
4.套接字<br/>
&emsp;&emsp;适用于不同机器间进程通讯，在本地也可作为两个进程通信.<br/>
5.信号<br/>
&emsp;&emsp;用于通知接收进程某个事件已经发生，例如键盘事件.<br/>
6.信号量<br/>
&emsp;&emsp;信号量是一个计数器，可以用来控制多个进程对共享资源的访问.<br/>

## **2.5 动态分区分配算法**
1.首次适应算法<br/>
&emsp;&emsp;每次都从低地址开始查找，找到第一个满足大小的空闲分区.<br/>
2.最佳适应算法<br/>
&emsp;&emsp;将空闲分区按容量递增次序链接，每次分配查找大小能满足要求的第一个空闲分区.<br/>
3.最大适应算法<br/>
&emsp;&emsp;将空闲分区按容量递减次序链接，每次分配查找大小能满足要求的第一个空闲分区.<br/>
4.邻近适应算法<br/>
&emsp;&emsp;空闲分区以地址递增的顺序排列(可排成-一个循环链表)。每次分配内存时从上次查找结束的位置开始查找空闲分区链(或空闲分区表)，找到大小能满足要求的第一个空闲分区<br/>

## **2.6 常见几种磁盘调度算法**
1.先来先服务<br/>
&emsp;&emsp;按照磁盘请求的顺序进行调度.<br/>
2.最短寻道时间优先<br/>
&emsp;&emsp;优先调度与当前磁头所在磁道距离最近的磁道.<br/>
3.电梯扫描算法<br/>
&emsp;&emsp;总是按一个方向来进行磁盘调度，直到该方向上没有未完成的磁盘请求，然后改变方向.<br/>

## **2.7 常见的几种锁**
1.读写锁<br />
&emsp;&emsp;可以同时读，写必须互斥，写优先于读.
2.互斥锁<br />
&emsp;&emsp;一次只能一个线程拥有互斥锁，其他线程只有等待.
3.条件变量<br />
&emsp;&emsp;条件变量通过允许线程阻塞和等待另一个线程发送信号的方法弥补了互斥锁的不足，他常和互斥锁一起使用，以免出现竞态条件
4.自旋锁<br />
&emsp;&emsp;如果进线程无法取得锁，进线程不会立刻放弃CPU时间片，而是一直循环尝试获取锁，直到获取为止。

# 3. **TCP/IP网络协议**

对于TCP/IP协议的学习，看过的书籍如下:<br />
1.<TCP/IP详解><br />
2.<嵌入式网络那些事:LwIP协议深度剖析和实战演练><br />
3.<HTTP权威指南><br />

## **3.1 协议分层**
<table style="text-align:center">
    <tr>
        <td>OSI模型</td>
        <td>物理层</td>
        <td>数据链路层</td>
        <td>网络层</td>
        <td>传输层</td>
        <td>会话层</td>
        <td>表示层</td>
        <td>应用层</td>
    </tr>
    <tr>
        <td>TCP/IP模型</td>
        <td colspan="2">网络接口层</td>
        <td>网络层</td>
        <td>传输层</td>
        <td colspan="3">应用层</td>
    </tr>
</table>
对于TCP/IP协议，主要说明功能如下:<br />

### **3.1.1 网络接口层** 
&emsp;&emsp;负责网络上的数据帧的接收和发送，由MAC+PHY两部分组成, 一般CPU中集成MAC，外挂PHY芯片，如常用的ip101gr,LAN8702A.CPU和PHY交互的接口分为用于配置的SMI接口(MDC/MDIO)和用于通讯的MII/RMII接口。MAC用于完成链路层的数据解析，发送时进行组包，接收时进行解包。PHY则是处理网络模拟信号和数字量的转换.<br />
&emsp;&emsp;除必要的通讯口外，如果使用MII接口，MII_RX_ER用于检测是否有错误包，如果未连接，会导致接收包错误丢弃.<br />
&emsp;&emsp;网络接口层的协议格式如下:<br />

| 目的端MAC地址 | 源端MAC地址 | 帧类型 |
| -------   | -------- | -------- |
| 6字节    | 6字节     |  2字节 |

其中帧类型, 0x0806是ARP包，0x0800是IP数据包.<br />
对于ARP协议，目的端IP地址为全0xFF 0xFF 0xFF 0xFF, 通过ARP协议获取目的的IP地址.<br />

### **3.1.1 网络层**
&emsp;&emsp;网络层的协议主要包含IP，ARP和RARP协议.<br />

**1.ARP:地址解析协议说明**<br />
&emsp;&emsp;ARP协议，全称Address Resolution Protocol(地址解析协议)，它是一个通过用于实现从IP地址到MAC地址的映射，既询问目标IP对应的MAC地址的一种协议.<br />
&emsp;&emsp;对于设备端，在内部维护一个ARP的缓存表，当用IP地址访问远端设备时，会先检查缓存表里是否存在，如果存在则直接使用IP，如果不存在，则发送一份称作ARP请求的以太网数据帧给以太网中的每个主机，目的主机收到广播报文后，会返回ARP应答保护IP地址和硬件地址，设备端收到后则更新缓存表，可以进行后续IP数据包的通信， 可以通过arp -a命令查询当前的arp缓存表.<br />

**2.RARP:逆地址解析协议说明**<br />
&emsp;&emsp;RARP提供硬件地址到IP地址的映射，一般用于无盘系统引导来获取IP地址的。RARP使用的帧类型为0x8035.<br />

**3.ICMP:网络控制报文协议**<br />
&emsp;&emsp;ICMP报文是基于IP协议实现的传递差错报文和其他信息的协议。如常用的ping，该程序发送一份ICMP回显请求报文，并等待回显应答，一般认为ping用于诊断最底层的硬件可靠性(不过现在随着路由器和防火墙的访问控制更新，部分接口可能不支持ping, 但能够访问上层接口)。<br />

**4.IP:网络协议**<br />
&emsp;&emsp;IP是TCP/IP协议族中最核心的协议，IP协议是不可靠的(不能保证IP数据能够成功到达目的地址)，另外是无连接的，每个数据包相对独立，不确保能按照发送顺序接收。<br />
<table  style="text-align:center">
    <tr >
        <td>4位版本</td>
        <td>4位首部长度</td>
        <td>8位服务类型(TOS)</td>
        <td colspan="2">16位总长度</td>
    </tr>
    <tr>
        <td colspan="3">16位标识 </td>
        <td>3位标志</td>
        <td>13位总长度</td>
    </tr>
    <tr>
        <td colspan="2">8位生存时间(TTL)</td>
        <td>8位协议</td>
        <td colspan="2">16位首部检验和</td>
    </tr>    
    <tr>
        <td colspan="5">32位源IP地址</td>
    </tr>  
    <tr>
        <td colspan="5">32位目的IP地址</td>
    </tr>  
</table>
&emsp;&emsp;其中TTL生存时间字段设置了数据报可以经过的最多路由器数，当该字段的值为 0时，数据报就被丢弃，并发送ICMP报文通知源主机。IP层在内存中有路由表，路由表每一项包含目的IP地址、下一站路由器地址、标志和传输指定一个网络接口，IP路由选择是逐跳地(hop-by-hop).<br />
子网掩码
<table>
    <tr>
        <td>网络号</td>
        <td>子网号</td>
        <td>主机号</td>
    </tr>
</table>
ifconfig命令(windows下为ipconfig):查询当前的网络接口配置.<br />
netstat命令:查询当前维持的网络连接.<br />

### **3.1.2 传输层**
**1.UDP:用户数据报协议**<br />
&emsp;&emsp;UDP是一个简单的面向数据报的运输层协议：进程的每个输出操作都产生一个UDP数据报，并组装成一份待发送的IP数据报, UPD数据包的格式为
<table>
    <tr>
        <td>IP首部</td>
        <td>UDP首部</td>
        <td>UDP数据</td>
    </tr>
</table>
其中UDP数据的格式为
<br />
<table  style="text-align:center">
    <tr >
        <td>16位源端口号</td>
        <td>16位目的端口号</td>
    </tr>
    <tr>
        <td>16位UDP长度</td>
        <td>16位UDP校验和</td>
    </tr>
    <tr>
        <td colspan="2">数据</td>
    </tr>    
</table>
在计算校验和时，会在首部前面添加12字节作为伪首部，如果数据长度为奇数，也会填充0。物理层MTU可通过"netsh interface ipv4 show subinterfaces"查询，分片一般为1500，如果不分片，UDP数据包要小于等于(1500-20-8=1472), 如果udp数据大于MTU值，则进行IP分片.<br />
IP地址包含单播地址，广播地址和多播地址，其中广播地址和多播地址仅用于UDP.<br />